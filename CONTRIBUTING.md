# 🛠️ PowerShell 脚本管理工具 开发与操作规范 (CONTRIBUTING)

> **版本**：1.0  
> **最后更新日期**：2026-02-28  
> **适用对象**：所有开发者（包括 AI 助手）

为了确保本项目代码的高质量、可维护性以及版本追踪的准确性，所有对本项目的修改必须遵循以下工作流和规范。

---

## 🚀 1. 开发工作流 (Workflow)

本项目区分 **“管理工具核心 (ScriptManager.ps1)”** 和 **“业务脚本 (Scripts/)”** 两类开发任务。

### 1.1 修改/新增业务脚本 (`Scripts/` 目录下)
**严禁直接手动修改 `Scripts/` 下的文件！** 必须通过管理工具进行操作，以触发自动备份机制。

1. **运行管理工具**：执行 `.\ScriptManager.ps1`。
2. **选择操作**：
   - **新增脚本**：选择 `[1]`。输入脚本名和描述，工具会自动创建文件并打开编辑器。
   - **修改脚本**：选择 `[2]`。工具会**先自动备份当前版本**到 `VersionBackup/`，然后再打开编辑器。
3. **完成编写后**：
   - 确保脚本能独立运行。
   - **更新 CHANGELOG**：在 `CHANGELOG.md` 中记录本次修改。
   - **同步文档**：如果修改了脚本的功能逻辑，请同步更新 `README.md` 中的“内置实用脚本介绍”部分。

### 1.2 修改管理工具核心 (`ScriptManager.ps1`)
由于管理工具是系统入口，对其修改需格外谨慎：

1. **手动备份**：在修改 `ScriptManager.ps1` 前，先手动复制一份备份（例如 `ScriptManager_backup.ps1`）。
2. **本地测试**：修改后必须运行一次工具，验证所有菜单功能（1-6）是否正常工作。
3. **更新元数据逻辑**：如果修改了元数据读取/保存逻辑，务必检查 `ScriptMetaData.json` 的兼容性。
4. **清理备份**：测试通过后删除手动备份。

---

## 📝 2. 代码编写规范 (Coding Standards)

### 2.1 命名约定
- **脚本文件名**：使用 `PascalCase`（如 `Export-Data.ps1`），推荐动词-名词结构。
- **变量名**：使用 `$camelCase`（如 `$targetPath`）。
- **函数名**：遵循 PowerShell 标准 `Verb-Noun`（如 `Get-ScriptList`）。

### 2.2 脚本头部文档 (Comment-Based Help)
每个业务脚本必须包含以下头部注释，以便于用户通过 `Get-Help` 查看：
```powershell
<#
.SYNOPSIS
    简短的功能描述。
.DESCRIPTION
    详细的功能说明、逻辑流程及注意事项。
.PARAMETER ParameterName
    参数说明。
.EXAMPLE
    运行示例。
#>
```

### 2.3 错误处理
- 关键操作（文件读写、网络请求等）必须包裹在 `try { ... } catch { ... }` 块中。
- 使用 `Write-Host -ForegroundColor Red` 或 `Write-Error` 输出清晰的错误信息。

### 2.4 交互设计规范 (Interaction Standards)
- **循环执行机制**：为了提升效率，所有业务脚本必须包含 `do...while` 循环逻辑。
- **运行完毕询问**：脚本执行完成后，必须询问用户“是否继续运行/统计新路径？(Y/N)”。
- **默认行为**：确认提示应默认设为 **Y**（即直接按 Enter 视为继续），除非用户明确输入 `N`。
- **示例代码**：
  ```powershell
  do {
      # 核心逻辑...
      $continueChoice = Read-Host "`n是否继续操作？(Y/N，默认Y)"
      $isContinue = ($continueChoice.Trim().ToLower() -ne "n")
  } while ($isContinue)
  ```

---

## 📑 3. 文档更新规范

### 3.1 更新日志 (CHANGELOG.md)
每次提交修改后，必须在 `CHANGELOG.md` 的顶部添加新记录：
- **格式**：`## [日期] - 简短概括`。
- **分类**：使用 `### ✨ 新增`、`### 🛠️ 修复`、`### 🎨 优化` 等子标题。

### 3.2 元数据 (ScriptMetaData.json)
- 通过管理工具修改脚本时，工具会自动维护 `Version` 和 `Description`。
- **严禁手动编辑此文件**，除非你需要修复元数据损坏问题。

---

## ✅ 4. 发布前自检清单
- [ ] 脚本是否能正常运行且无报错？
- [ ] 脚本是否包含循环运行逻辑（询问是否再次运行）？
- [ ] 是否已通过 `ScriptManager.ps1` 进行修改（以生成备份）？
- [ ] `CHANGELOG.md` 是否已记录本次改动？
- [ ] `README.md` 中的描述是否与代码功能一致？
- [ ] (若有新增参数) 脚本头部文档是否已更新？

---

**请严格遵守以上规范，共同维护一个整洁高效的自动化工具库！**
